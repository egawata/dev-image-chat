# Claude Code 画像チャット

## やりたいこと

Claude Code 内での会話から、そのときの状況に合わせた画像をリアルタイムで生成してブラウザ上に表示する

## 処理例

user: xxx の対応を行ってください
assistant: わかりました！質問があります。xxx はどのようにしたらいいでしょうか？
システム: assistant がユーザに向かって質問しているような仕草の画像を生成して表示

user: では xxx にしてください
assistant: わかりました！実装をはじめます！
システム: assistant がOKサインを出している画像

assistant: できました！
システム: assistant が喜んでいる画像

## 実装案

以下のパイプラインを連結して順次処理していく

- Claude Code の生ログの生成を監視
    - ~/.claude/projects 以下にある .jsonl ファイルが生成、もしくは更新されたことを検知
- 更新されたファイルから生ログを取得
- 実際に Claude Code 上に表示される user, assistant の会話のみ抽出
    - jq コマンドで抽出できるはず
- 最後が assistant の場合のみ、画像生成プロンプトの作成をテキスト生成AIに依頼
    - これまでの会話内容を json 形式にして、この会話の流れのあと最新の状況を表す画像のプロンプトを生成してください、と依頼
- 作成された画像生成プロンプトをもとに、画像生成AIに画像作成を依頼する
- 生成された画像をファイルとして保存する
- webサーバは、新しい画像が生成されているか定期的(5秒 or websocket)に監視し、ブラウザ上に最新の画像を送信する

## 補足

- テキスト生成AIは、初期状態では gemini を使用する。
- 画像生成AIは、初期状態では Stable Diffusion (AUTOMATIC1111) の API を使用する
    - http://localhost:7860 で起動しているもの
